<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïµÔ∏è‚Äç‚ôÄÔ∏èüêæ Pink Panther Comment Builder</title> <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FCE4EC; /* Brighter, muted pink background */
        }
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .category-title {
            /* New Style for Category Headings */
            @apply text-xl font-bold text-gray-800 mt-6 mb-3 border-b-2 border-pink-500 pb-1; 
            display: flex; /* Allow emoji and text to be on the same line */
            align-items: center; /* Vertically align emoji with text */
            gap: 0.5rem; /* Space between emoji and text */
        }
        .word-button {
            background-color: #EC407A; /* Brighter, muted rose pink */
            color: white;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease-in-out;
            transform: scale(1);
            outline: none;
            min-width: 100px;
            margin: 0.5rem;
            cursor: pointer;
            display: flex; /* Added for emoji alignment */
            align-items: center; /* Added for emoji alignment */
            gap: 0.3rem; /* Space between emoji and text on button */
            justify-content: center; /* Center content on button */
        }
        .word-button:hover {
            background-color: #D81B60; /* Slightly deeper on hover */
            transform: scale(1.03); /* Slight change to hover scale for better feel */
        }
        .word-button:focus {
            box-shadow: 0 0 0 2px rgba(236, 64, 122, 0.5);
        }
        .control-button {
            @apply text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-opacity-75;
            display: flex; /* Added for emoji alignment */
            align-items: center; /* Added for emoji alignment */
            gap: 0.3rem; /* Space between emoji and text on button */
            justify-content: center; /* Center content on button */
        }
        /* Specific colors for control buttons */
        #clearButton, #copyButton { @apply bg-purple-600 hover:bg-purple-700 focus:ring-purple-500; }
        #undoButton { @apply bg-orange-500 hover:bg-orange-600 focus:ring-orange-500; }
        #deleteLastWordButton { @apply bg-red-500 hover:bg-red-600 focus:ring-red-500; }
        
        textarea {
            @apply resize-y;
            min-height: 120px;
        }
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .message-box.show {
            opacity: 1;
        }
        .bottom-image {
            display: block;
            margin: 2rem auto;
            max-width: 50%;
            height: auto;
            border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        /* Custom Input Styling */
        .custom-input-group {
            @apply flex items-stretch mt-4 mb-6;
        }
        .custom-input {
            @apply flex-grow p-2 border border-gray-300 rounded-l-lg focus:ring-pink-500 focus:border-pink-500 text-gray-700;
        }
        .custom-add-button {
            @apply bg-pink-500 hover:bg-pink-600 text-white font-semibold py-2 px-4 rounded-r-lg shadow-md transition-all duration-200 ease-in-out;
        }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <div class="flex items-center justify-center mb-6">
            <img src="https://via.placeholder.com/60x60/FF69B4/FFFFFF?text=üêæ" alt="Pink Panther Icon" class="mr-3 rounded-full">
            <h1 class="text-3xl font-bold text-center text-gray-800">üïµÔ∏è‚Äç‚ôÄÔ∏è Pink Panther Comment Builder üêæ</h1> <img src="https://via.placeholder.com/60x60/FFC0CB/000000?text=üîç" alt="Decorative Magnifying Glass Icon" class="ml-3 rounded-full">
        </div>

        <textarea id="commentOutput"
                    class="w-full p-4 mb-4 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 text-gray-700 text-lg"
                    placeholder="Click phrases below, or add custom text, to build your comment..."
                    readonly></textarea>

        <div class="flex justify-center space-x-4 mb-8">
            <button id="undoButton" class="control-button">‚Ü©Ô∏è Undo Last Action</button> <button id="deleteLastWordButton" class="control-button">‚úñÔ∏è Delete Last Word</button> <button id="clearButton" class="control-button">üßπ Clear Comment</button> <button id="copyButton" class="control-button">üìã Copy to Clipboard</button> </div>

        <div class="custom-input-group">
            <input type="text" id="customInput" class="custom-input" placeholder="Add custom text or phrase">
            <button id="addCustomButton" class="custom-add-button">‚úçÔ∏è Add Custom</button> </div>
        
        <div id="categoryButtonsContainer">
            </div>
    </div>

    <div id="messageBox" class="message-box"></div>

    <img src="mea.png" alt="Pink Panther Character" class="bottom-image">

    <script>
        // UPDATED: Categorized predefined words and phrases, including all new requests
        const predefinedCategories = {
            "üïµÔ∏è‚Äç‚ôÄÔ∏è Fraud Indicators": [ // EMOJI ADDED HERE
                "Pink Panther - scam - Do Not Unblock!",
                "Malicious IP.",
                "Carrier suspected fraud.",
                "Known scam pattern.",
                "Suspicious fingerprints.",
                "Suspicious Tracking.",
                "Suspicious Transaction history.",
                "Suspicious Chat log.",
                "Empty Parcel Scam / Pattern Potential Fraudelant member. Please proceed with caution and investigate thoroughly if a similar issue occurs.", 
                "Malicious Multiple Accounts. Buyer and Seller are the same person.", 
                "Abuse of Compensation.", 
                "Sending same proof in multiple TXs." 
            ],
            "üë§ Account & Member Behavior": [ // EMOJI ADDED HERE
                "New account.",
                "Non responsive member.",
                "Member inactive since TX creation.",
                "1st High value TX.",
                "Member has a pattern of Lost Parcel compensation abuse.", 
                "Member only uses Public IPs.", 
                "Suspicious account changes.", 
                "Username, Member's name and Email do not match.", 
                "Over 3 Months Gap between transactions.", 
                "Too many shipping addresses with diffrent details.", 
                "Using VPS to mask their location." 
            ],
            "üì¶ Item & Listing Issues": [ // EMOJI ADDED HERE
                "Suspicious listings.",
                "Listing taken from the web.",
                "Listing/item commonly used with scam cases.",
                "Suspicious deleted items.",
                "Item retail price doesn't match.",
                "All High value items are canceled.", 
                "Listings are cropped.", 
                "Too many duplicate listings.", 
                "Item presumably lost or damaged is relisted." 
            ],
            "üöö Shipping & Parcel Status": [ // EMOJI ADDED HERE
                "Suspicious drop off point.",
                "Signs of label manipulation.",
                "Drop off point is over 2 hours away.", 
                "Asks only for a Specific Carrier.", 
                "No updates after drop off.", 
                "Parcel refused.", 
                "Same listings found on another account.", 
                "Phone number code doesn't match the area." 
            ]
        };

        const commentOutput = document.getElementById('commentOutput');
        const categoryButtonsContainer = document.getElementById('categoryButtonsContainer');
        const clearButton = document.getElementById('clearButton');
        const copyButton = document.getElementById('copyButton');
        const undoButton = document.getElementById('undoButton');
        const deleteLastWordButton = document.getElementById('deleteLastWordButton');
        const customInput = document.getElementById('customInput');
        const addCustomButton = document.getElementById('addCustomButton');
        const messageBox = document.getElementById('messageBox');

        // History stack to support the Undo function
        let historyStack = [];
        const MAX_HISTORY = 20;

        function saveHistory() {
            // Save state ONLY if the current value is different from the last saved state
            if (historyStack.length === 0 || historyStack[historyStack.length - 1] !== commentOutput.value) {
                if (historyStack.length >= MAX_HISTORY) {
                    historyStack.shift(); // Remove oldest entry
                }
                historyStack.push(commentOutput.value);
            }
        }
        
        function restoreState(newState) {
            commentOutput.value = newState;
            commentOutput.scrollTop = commentOutput.scrollHeight;
        }

        // Function to display a temporary message
        function showMessage(message, type = 'success') {
            messageBox.textContent = message;
            messageBox.className = 'message-box show';
            // Set colors for success/error messages
            messageBox.style.backgroundColor = (type === 'error') ? '#f44336' : '#20c997'; 

            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 2000);
        }

        // Function to create and append categorized word buttons
        function createWordButtons() {
            categoryButtonsContainer.innerHTML = ''; 

            for (const category in predefinedCategories) {
                // 1. Create Category Title
                const title = document.createElement('h2');
                title.innerHTML = category; // Use innerHTML to render emoji
                title.className = 'category-title';
                categoryButtonsContainer.appendChild(title);

                // 2. Create Button Group Container
                const buttonGroup = document.createElement('div');
                buttonGroup.className = 'flex flex-wrap justify-center gap-3 mb-4';
                
                // 3. Create Buttons for the Category
                predefinedCategories[category].forEach(word => {
                    const button = document.createElement('button');
                    // Add a subtle emoji to each word button
                    button.innerHTML = `<span>${word}</span>`; 
                    if (category.includes("Fraud")) {
                         button.innerHTML = `‚ö†Ô∏è ${word}`;
                    } else if (category.includes("Account")) {
                         button.innerHTML = `üë§ ${word}`;
                    } else if (category.includes("Item")) {
                         button.innerHTML = `üè∑Ô∏è ${word}`;
                    } else if (category.includes("Shipping")) {
                         button.innerHTML = `‚úàÔ∏è ${word}`;
                    }

                    button.className = 'word-button';
                    
                    button.addEventListener('click', () => {
                        saveHistory(); // Save state BEFORE adding the word
                        
                        // Spacing logic: Add a space unless the output is empty or the word starts with punctuation.
                        let newValue = commentOutput.value;
                        // Use regex to check for common leading punctuation
                        if (newValue.length > 0 && !newValue.endsWith(' ') && !/^[.,!?]/.test(word)) {
                            newValue += ' ';
                        }
                        commentOutput.value = newValue + word;
                        commentOutput.scrollTop = commentOutput.scrollHeight;
                    });
                    buttonGroup.appendChild(button);
                });
                categoryButtonsContainer.appendChild(buttonGroup);
            }
        }

        // --- Event Listeners ---

        // NEW: Undo Button Logic (Undo Last Action)
        undoButton.addEventListener('click', () => {
            if (historyStack.length > 1) {
                // Pop the current state (the one we want to undo)
                historyStack.pop(); 
                // Restore the previous state
                restoreState(historyStack[historyStack.length - 1]); 
                showMessage('Action undone.', 'success');
            } else if (historyStack.length === 1 && commentOutput.value !== '') {
                 // Special case: go back to the initial empty state
                historyStack = [''];
                restoreState('');
                showMessage('Comment cleared (restored to initial state).', 'success');
            } else {
                showMessage('No history to undo.', 'error');
            }
        });

        // NEW: Delete Last Word Button Logic
        deleteLastWordButton.addEventListener('click', () => {
            if (commentOutput.value) {
                saveHistory(); // Save state BEFORE deleting
                // Use regex to find and remove the last word (or punctuation group)
                let newValue = commentOutput.value.replace(/\s*[^\s]*$/, '');
                restoreState(newValue);
                showMessage('Last word deleted!', 'success');
            } else {
                showMessage('Comment is already empty.', 'error');
            }
        });

        // NEW: Custom Text Button Logic
        addCustomButton.addEventListener('click', () => {
            const customText = customInput.value.trim();
            if (customText) {
                saveHistory(); // Save state BEFORE adding text
                
                let newValue = commentOutput.value;
                // Spacing logic (same as word buttons)
                if (newValue.length > 0 && !newValue.endsWith(' ') && !/^[.,!?]/.test(customText)) {
                    newValue += ' ';
                }
                commentOutput.value = newValue + customText;
                customInput.value = ''; // Clear the input field
                commentOutput.scrollTop = commentOutput.scrollHeight;
                showMessage('Custom text added.', 'success');
            } else {
                showMessage('Please enter text to add.', 'error');
            }
        });
        // Allow pressing Enter in custom input to trigger add
        customInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // Prevent new line in input
                addCustomButton.click();
            }
        });

        // Clear button
        clearButton.addEventListener('click', () => {
            if (commentOutput.value) {
                saveHistory(); // Save the state before clearing (so clear is undoable)
            }
            commentOutput.value = '';
            // Ensure the history stack is correctly set to the empty state
            historyStack.push(''); 
            showMessage('Comment cleared!', 'success');
        });

        // Copy button
        copyButton.addEventListener('click', () => {
            if (commentOutput.value) {
                navigator.clipboard.writeText(commentOutput.value)
                    .then(() => {
                        showMessage('Comment copied to clipboard!', 'success');
                    })
                    .catch(err => {
                        console.error('Failed to copy text: ', err);
                        showMessage('Failed to copy comment.', 'error');
                    });
            } else {
                showMessage('Nothing to copy!', 'error');
            }
        });

        // Initialize buttons and save the initial empty state
        document.addEventListener('DOMContentLoaded', () => {
            createWordButtons();
            // Save the initial empty state for a proper undo/clear flow
            saveHistory(); 
        });
    </script>
</body>
</html>
